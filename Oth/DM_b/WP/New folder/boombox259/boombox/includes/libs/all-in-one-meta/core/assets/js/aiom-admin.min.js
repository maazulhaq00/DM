!function(e){"use strict";function i(i,a,t){var r,l=e(i),n=l.length,o=0==n?0:1==n?l.val():l.map(function(){return this.value}).get();switch(o=void 0===o?0:o,t){case"===":r=o===a;break;case"==":case"=":r=o==a;break;case"!==":r=o!==a;break;case"!=":r=o!=a;break;case">=":r=a>=o;break;case"<=":r=a<=o;break;case">":r=a>o;break;case"<":r=a<o;break;case"IN":a instanceof Array||(a=a.split()),r=a.filter(function(e){return-1!==o.indexOf(e)}).length>0;break;case"NOT IN":a instanceof Array||(a=a.split()),r=0==a.filter(function(e){return-1!==o.indexOf(e)}).length;break;default:r=o==a}return r}e(".aiom-admin-tabs-menu a").on("click",function(i){var a=e(this),t=a.attr("href"),r=a.closest(".aiom-admin-tabs").find(".aiom-admin-tab-content");a.parent().addClass("active"),a.parent().siblings().removeClass("active"),r.not(t).removeClass("active").hide(),e(t).addClass("active").fadeIn(500),i.preventDefault()}),e(".aiom-advanced-fields #aiom_video_url").on("change",function(){var i=e(this),a=i.val();if("-1"!=a.indexOf("<iframe")){var t=a.match(/src="([^"]+)"/);t&&i.val(t[1])}}),e('.aiom-advanced-fields input[type="radio"], .aiom-advanced-fields input[type="checkbox"], .aiom-advanced-fields select').on("change",function(){var a=e(this),t=a.attr("id"),r=(a.val(),e(".aiom-advanced-fields .aiom-superior-"+t));if(r.length<=0)return!1;for(var l=0;l<r.length;l++){var n=e(r[l]),o=n.parent(),s=JSON.parse(n.text());if(s){for(var d="AND"==s.relation,m=0;m<s.fields.length;m++){var f=i(s.fields[m].jq_selector,s.fields[m].value,s.fields[m].compare);d="AND"==s.relation?d&&f:d||f}d?o.removeClass("aiom-hidden"):o.addClass("aiom-hidden")}}}),e(".aiom-advanced-fields .aiom-form-row-radio-image .field-list-item").on("click",function(){var i=e(this);i.is(".selected")||i.addClass("selected").siblings().removeClass("selected").end().find('input[type="radio"]').prop("checked",!0).trigger("change")}),e(".aiom-form-row-color, .aiom-form-row-multicolor").length>0&&e(".aiom-form-row-color input, .aiom-form-row-multicolor input").wpColorPicker({change:function(e,i){},clear:function(){},hide:!0}),wp.media.AIOM_libEditGallery={open:function(e){this.frame(e).open()},delete:function(e){var i=e.closest(".upload-wrapper"),a=i.find(".field-list"),t=i.find(".image_ids");i.removeData("aiom-lib-gallery"),a.html(""),t.val("")},frame:function(i){var a=i.closest(".upload-wrapper"),t=(a.find(".field-list"),a.find(".image_ids"),this.select(i));return this._frame=a.data("aiom-lib-gallery"),this._frame||(this._frame=wp.media({id:"my-frame",frame:"post",state:"gallery-edit",title:wp.media.view.l10n.editGalleryTitle,editing:!0,multiple:!0,selection:t}),this._frame.on("update",function(a){var t=i.closest(".upload-wrapper"),r=t.find(".field-list"),l=t.find(".image_ids"),n=a.toJSON(),o=[];r.html("");for(var s=0;s<n.length;s++){var d=n[s],m=d.url,f=d.name;o.push(d.id),d.hasOwnProperty("sizes")&&(d.sizes.hasOwnProperty("thumbnail")?m=d.sizes.thumbnail.url:d.sizes.hasOwnProperty("medium")?m=d.sizes.medium.url:d.sizes.hasOwnProperty("full")&&(m=d.sizes.full.url)),e('<div class="field-list-item"><img src="'+m+'" alt="'+f+'" /></div>').appendTo(r)}l.val(o.join(","))}),a.data("aiom-lib-gallery",this._frame)),this._frame},select:function(e){var i,a,t=e.closest(".upload-wrapper").find(".image_ids").attr("value"),r=t?wp.shortcode.next("gallery","[gallery ids='"+t+"]"):"",l=wp.media.gallery.defaults.id;if(r)return r=r.shortcode,_.isUndefined(r.get("id"))&&!_.isUndefined(l)&&r.set("id",l),_.isUndefined(r.get("ids"))&&t&&r.set("ids",t),_.isUndefined(r.get("ids"))&&r.set("ids","0"),i=wp.media.gallery.attachments(r),(a=new wp.media.model.Selection(i.models,{props:i.props.toJSON(),multiple:!0})).gallery=i.gallery,a.more().done(function(){a.props.set({query:!1}),a.unmirror(),a.props.unset("orderby")}),a}},e(document).on("click",".aiom-form-row-image .button-upload",function(i){var a=e(this).closest(".upload-wrapper"),t=a.find(".image_id"),r=a.find(".image-wrapper").find(".image-holder"),l=(a.find(".buttons-wrapper"),a.data("file_frame"));i.preventDefault(),l?l.open():((l=wp.media.frames.downloadable_file=wp.media({multiple:!1})).on("select",function(){var e,i=l.state().get("selection").first().toJSON(),n=r.find("img"),o=i.name,s=i.url;i.hasOwnProperty("sizes")&&(i.sizes.hasOwnProperty("medium")?s=i.sizes.medium.url:i.sizes.hasOwnProperty("thumbnail")?s=i.sizes.thumbnail.url:i.sizes.hasOwnProperty("full")&&(s=i.sizes.full.url)),e='<img src="'+s+'" alt="'+o+'" />',t.val(i.id),n.length>0?n.replaceWith(e):r.append(e),a.addClass("has-image")}),e.data(a,"_file_frame",l),l.open())}).on("click",".aiom-form-row-image .placeholder",function(){e(this).closest(".aiom-form-row-image").find(".button-upload").trigger("click")}).on("click",".aiom-form-row-image .button-remove",function(i){var a=e(this).closest(".upload-wrapper"),t=a.find(".image_id");i.preventDefault(),t.val(""),a.removeClass("has-image")}).on("click",".aiom-form-row-gallery .button-upload",function(i){i.preventDefault(),wp.media.AIOM_libEditGallery.open(e(this))}).on("click",".aiom-form-row-gallery .button-remove",function(i){i.preventDefault(),wp.media.AIOM_libEditGallery.delete(e(this))}),e(".aiom-form-row-date").length>0&&e('.aiom-form-row-date input[type="text"]').each(function(){var i=e(this),a=i.attr("js-config");if(i.removeAttr("js-config"),"minDate"in(a=JSON.parse(a))&&e.isNumeric(a.minDate)){var t=new Date(1e3*a.minDate);t.getTime()>0&&(a.minDate=t)}if("maxDate"in a&&e.isNumeric(a.maxDate)){var r=new Date(1e3*a.maxDate);r.getTime()>0&&(a.maxDate=r)}console.log(a),e(this).datepicker(a)})}(jQuery);